<!DOCTYPE html>
<html ng-app="RadarChart">

<head>
  <meta charset="utf-8">
  <title>MUSIC FEATURES VISUALIZATION </title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" />
</head>

<style>
  body {
    font-family: "Open Sans", sans-serif;
    font-size: 12px;
    font-weight: 400;
    padding-top: 10px;
    padding-bottom: 100px;
  }

  html {
    overflow-y: scroll;
  }

  h1 {
    color: rgb(180, 70, 70);
    font-weight: 800;
    font-size: 1.7em;
  }

  h2 {
    color: steelblue;
    font-size: 1.3em;
    padding-bottom: 10px;
  }

  h3 {
    color: gray;
    font-size: 1.2em;
    padding-bottom: 10px;
  }

  footer a,
  footer a:hover,
  footer a:visited {
    color: #D2A000;
  }

  .text-small {
    font-size: 12px;
    font-style: italic;
  }

  footer {
    color: white;
    padding-top: 5px;
    border-top: 1px solid gray;
    font-size: 12px;
    position: fixed;
    left: 0;
    bottom: 0;
    height: 50px;
    width: 100%;
    background: black;
    text-align: center;
  }

  pre {
    height: 200px;
    font-size: 9px;
    overflow-y: scroll;
  }

  .form-control-inline {
    display: inline;
    width: 40px;
    margin-right: 5px;
  }

  .configuration {
    font-size: 0.8em;
    width: 250px;
    border: 1px solid #ddd;
    padding-left: 20px;
    margin-bottom: 20px;
  }

  .checkbox {
    margin-left: 20px;
  }

  .slider {
    -webkit-appearance: none;
    width: 90%;
    height: 10px;
    background: #d3d3d3;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
  }

  .slider:hover {
    opacity: 1;
  }

  .slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 15px;
    height: 15px;
    background: #1f4921;
    cursor: pointer;
  }

  .slider::-moz-range-thumb {
    width: 15px;
    height: 15px;
    background: #4CAF50;
    cursor: pointer;
  }
</style>

<body>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
 
  <!-- header -->
  <header class="page-header">
    <h1>MUSIC FEATURES VISUALIZATION</h1>
  </header>

  <!-- main content -->
  <div class="main container">
    <!-- visualization -->
    <div class="visualization col-xs-7">
      <svg width="100%" ; height="600px"></svg>
    </div>

    <!-- configuration -->
    <script>
      $(document).ready(function () {
        $.ajax({
          type: "GET",
          url: "Data/data_by_year.csv",
          dataType: "text",
          success: function (data) { processData1(data); }
        });
      });
      var year_data = [];
      function processData1(allText) {
        var allTextLines = allText.split(/\r\n|\n/);
        var headers = allTextLines[0].split(',');
        for (var i = 1; i < allTextLines.length; i++) {
          var data = allTextLines[i].split(',');
          var tarr = [];
          for (var j = 0; j < headers.length; j++) {
            let obj = {}
            console.log(data[1][1])
            obj.year = data[1]
            obj.danceability = data[2]
            obj.energy = data[3]
            obj.liveness = data[4]
            obj.tempo = data[5]
            tarr.push(obj)
          }
          year_data.push(tarr);
        }

        console.log(year_data)

        year_data.forEach(function (element, i) {
          year_data[i].year = parseInt(year_data[i][0].substring(year_data[i][0].indexOf(":") + 1))
        })
        const result = year_data.filter(year_data => year_data.year == '1924');

        console.log(result);
      }

    </script>
    <div class="configuration col-xs-5">
      <form id="dat">
        <h3>Choose The Area You Want To Investigate In</h3>
        <input type="radio" id="Year" name="option" value="Year" onclick="div_OnOff()">Year<br> </input>
        <input type="radio" id="Genre" name="option" value="Genre" onclick="div_OnOff()">Genre<br> </input>
        <input type="radio" id="Artist" name="option" value="Artist" onclick="div_OnOff()">Artist<br> </input>
      </form>

      <script>

      </script>

      <script>
        function div_OnOff() {
          if ($('input:radio[id=Year]').is(':checked')) {
            $('#year').show();
            $('#genre').hide();
            $('#artist').hide();

          } else if ($('input:radio[id=Genre]').is(':checked')) {
            $('#year').hide();
            $('#genre').show();
            $('#artist').hide();

          } else if ($('input:radio[id=Artist]').is(':checked')) {
            $('#year').hide();
            $('#genre').hide();
            $('#artist').show();

          } else {
            $('#year').hide();
            $('#genre').hide();
            $('#artist').hide();
          }
        }
      </script>

      <div id="year">
        <br>
        <form id="slideyear">
          <input type="range" min="1921" max="2020" value="1921" class="slider" id="myRange">
          <p>Year: <span id="demo"></span></p>
        </form>
        <br>
      </div>

      <script>
        var slider = document.getElementById("myRange");
        var output = document.getElementById("demo");
        output.innerHTML = slider.value;

        slider.oninput = function () {
          output.innerHTML = this.value;
        }

      </script>

      <div id="genre">
        <br>
        <form id="search1">
          <input id="genre_search_box" type="text" name="search1" value="Insert Genre">
          <button onclick="find_genre_in_clust();">Submit</button>
        </form>
        <br>
      </div>
      <script>
        var global_gen;
        d3.csv("Data/data_by_genres.csv", function (gen) {
          var all_gen = [];
          for (var i = 0; i < gen.length; i++) {
            all_gen.push(gen[i].genres);
          };

          $("#genre_search_box").autocomplete({
            source: all_gen
          });

          $("#genre_search_box").keyup(function (e) {
            if (e.keyCode == 13) {
              find_genre_in_clust();
            }
          });
        });
        function find_genre_in_clust() {
          search_gen = $('#genre_search_box').val();

          if (all_gen.indexOf(search_gen) != -1) {

          }
        };
      </script>

      <div id="artist">
        <br>
        <form id="search2">
          <input id="artist_search_box" type="text" name="search2" value="Insert Artist's Name">
          <button onclick="find_artist_in_clust();">Submit</button>
        </form>
        <br>
      </div>
      <script>
        var global_art;
        d3.csv("Data/data_by_artist.csv", function (art) {
          var all_art = [];
          for (var i = 0; i < art.length; i++) {
            all_art.push(art[i].artists);
          };

          $("#artist_search_box").autocomplete({
            source: all_art
          });

          $("#artist_search_box").keyup(function (e) {
            if (e.keyCode == 13) {
              find_artist_in_clust();
            }
          });
        });
        function find_airtist_in_clust() {
          search_art = $('#artist_search_box').val();

          if (all_art.indexOf(search_art) != -1) {

          }
        };


      </script>

      <br>
      If you click the append checkbox, you can attach the graphs and compare those
      <br>
      <div id="append">
        <input type="checkbox" name="myCheckBox" id="myCheckBox" onclick="myfunction1()">
        <label for="myCheckBox">append 1</label>
        <p id="text" style="display:none"></p> <br>
        <input type="checkbox" name="myCheckBox2" id="myCheckBox2" onclick="myfunction2()">
        <label for="myCheckBox2">append 2</label> <br>
        <input type="checkbox" name="myCheckBox3" id="myCheckBox3" onclick="myfunction3()">
        <label for="myCheckBox3">append 3</label> <br>
        <input type="checkbox" name="myCheckBox4" id="myCheckBox4" onclick="myfunction4()">
        <label for="myCheckBox4">append 4</label> <br>
      </div>

      <script>
        var features = ["danceability", "energy", "liveness", "tempo"];
        var data = [];
        for (var i = 0; i < 1; i++) {
          var point = {}
          features.forEach(f => point[f] = Math.random());
          data.push(point);
        }

        var dat1 = [];
        function myfunction1() {
          var checkBox = document.getElementById("myCheckBox");
          var text = document.getElementById("text");
          if (checkBox.checked == true) {
            dat1.push(...data);
            render_dat1()
            return dat1;
          } else {
            dat1.pop();
            render_dat1()
            return dat1;
          }
        }

        var dat2 = [];
        function myfunction2() {
          var checkBox = document.getElementById("myCheckBox2");
          var text = document.getElementById("text");
          if (checkBox.checked == true) {
            dat2.push(...data);
            render_dat2()
            return dat2;
          } else {
            dat2.pop();
            render_dat2()
            return dat2;
          }
        }

        var dat3 = [];
        function myfunction3() {
          var checkBox = document.getElementById("myCheckBox3");
          var text = document.getElementById("text");
          if (checkBox.checked == true) {
            dat3.push(...data);
            render_dat3()
            return dat3;
          } else {
            dat3.pop();
            render_dat3()
            return dat3;
          }
        }
        
        var dat4 = [];
        function myfunction4() {
          var checkBox = document.getElementById("myCheckBox4");
          var text = document.getElementById("text");
          if (checkBox.checked == true) {
            dat4.push(...data);
            render_dat4()
            return dat4;
          } else {
            dat4.pop();
            render_dat4()
            return dat4;
          }
        }

      </script>


    </div>



    <script>
      var svg = d3.select("svg")
        .attr("width", 600)
        .attr("height", 600);
      var radialScale = d3.scale.linear()
        .range([0, 250])
        .domain([0, 1]);
      var ticks = [0.2, 0.4, 0.6, 0.8, 1];
      ticks.forEach(t =>
        svg.append("circle")
          .attr("cx", 300)
          .attr("cy", 300)
          .attr("fill", "none")
          .attr("stroke", "black")
          .attr("r", radialScale(t))
      );
      ticks.forEach(t =>
        svg.append("text")
          .attr("x", 305)
          .attr("y", 300 - radialScale(t))
          .text(t.toString())
      );
      function angleToCoordinate(angle, value) {
        var x = Math.cos(angle) * radialScale(value);
        var y = Math.sin(angle) * radialScale(value);
        return { "x": 300 + x, "y": 300 - y };
      }
      for (var i = 0; i < 4; i++) {
        var ft_name = features[i];
        var angle = (Math.PI / 2) + (2 * Math.PI * i / 4);
        var line_coordinate = angleToCoordinate(angle, 1.5);
        var label_coordinate = angleToCoordinate(angle, 1.1);

        //draw axis line
        svg.append("line")
          .attr("x1", 300)
          .attr("y1", 300)
          .attr("x2", line_coordinate.x)
          .attr("y2", line_coordinate.y)
          .attr("stroke", "black");

        //draw axis label
        svg.append("text")
          .attr("x", label_coordinate.x)
          .attr("y", label_coordinate.y)
          .text(ft_name);
      }

      var line = d3.svg.line()
        .x(d => d.x)
        .y(d => d.y);

      function getPathCoordinates(data_point) {
        var coordinates = [];
        for (var i = 0; i < 4; i++) {
          var ft_name = features[i];
          var angle = (Math.PI / 2) + (2 * Math.PI * i / 4);
          coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
        }
        return coordinates;
      }

      for (var i = 0; i < data.length; i++) {
        var d = data[i];
        var coordinates = getPathCoordinates(d);

        svg.append("path")
          .datum(coordinates)
          .attr("d", line)
          .attr("stroke-width", 3)
          .attr("stroke", "yellow")
          .attr("fill", "yellow")
          .attr("stroke-opacity", 1)
          .attr("opacity", 0.5)
        // .on("mouseover", function (d, i) {
        //    d3.select(this).transition()
        //    .duration('50')
        //    .attr('opacity', '.85');
        //     div.transition()
        //       .duration('50')
        //       .style("opacity",1);
        // })
        // .on('mouseout',function (d,i) {
        //   d3.select(this).transition()
        //   .duration('50')
        //   .attr('opacity', '1');
        //     div.transition()
        //       .duration('50')
        //       .style("opacity", 0);
        // });
      }



      function render_dat1() {

        let d1, coordinates1;
        if (dat1.length > 0) {
          d1 = dat1[0];
          coordinates1 = [getPathCoordinates(d1)];
        }
        else {
          coordinates1 = []
        }

        let u = svg.selectAll('.d1').data(coordinates1)

        u.enter().append("path")
          .attr('class', 'd1')
          .attr("d", line)
          //.transition()
          //.duration(1000)
          .attr("stroke-width", 3)
          .attr("stroke", "green")
          .attr("fill", "green")
          .attr("stroke-opacity", 1)
          .attr("opacity", 0.5)

        u.exit()
          //.transition()
          //.duration(1000)
          .remove()
      }

      function render_dat2() {

      let d2, coordinates2;
      if (dat2.length > 0) {
        d2 = dat2[0];
        coordinates2 = [getPathCoordinates(d2)];
      }
      else {
        coordinates2 = []
      }

      let u = svg.selectAll('.d2').data(coordinates2)

      u.enter().append("path")
        .attr('class', 'd2')
        .attr("d", line)
        //.transition()
        //.duration(1000)
        .attr("stroke-width", 3)
        .attr("stroke", "blue")
        .attr("fill", "blue")
        .attr("stroke-opacity", 1)
        .attr("opacity", 0.5)

      u.exit()
        //.transition()
        //.duration(1000)
        .remove()
      }

      function render_dat3() {

      let d3, coordinates3;
      if (dat3.length > 0) {
        d3 = dat3[0];
        coordinates3 = [getPathCoordinates(d3)];
      }
      else {
        coordinates3 = []
      }

      let u = svg.selectAll('.d3').data(coordinates3)

      u.enter().append("path")
        .attr('class', 'd3')
        .attr("d", line)
        //.transition()
        //.duration(1000)
        .attr("stroke-width", 3)
        .attr("stroke", "red")
        .attr("fill", "red")
        .attr("stroke-opacity", 1)
        .attr("opacity", 0.5)

      u.exit()
        //.transition()
        //.duration(1000)
        .remove()
      }

      function render_dat4() {

      let d4, coordinates4;
      if (dat4.length > 0) {
        d4 = dat4[0];
        coordinates4 = [getPathCoordinates(d4)];
      }
      else {
        coordinates4 = []
      }

      let u = svg.selectAll('.d4').data(coordinates4)

      u.enter().append("path")
        .attr('class', 'd4')
        .attr("d", line)
        //.transition()
        //.duration(1000)
        .attr("stroke-width", 3)
        .attr("stroke", "pink")
        .attr("fill", "pink")
        .attr("stroke-opacity", 1)
        .attr("opacity", 0.5)

      u.exit()
        //.transition()
        //.duration(1000)
        .remove()
      }



      svg.append("circle").attr("cx", 540).attr("cy", 500).attr("r", 6).style("fill", "yellow")
      svg.append("circle").attr("cx", 540).attr("cy", 520).attr("r", 6).style("fill", "green")
      svg.append("circle").attr("cx", 540).attr("cy", 540).attr("r", 6).style("fill", "blue")
      svg.append("circle").attr("cx", 540).attr("cy", 560).attr("r", 6).style("fill", "red")
      svg.append("circle").attr("cx", 540).attr("cy", 580).attr("r", 6).style("fill", "pink")
      svg.append("text").attr("x", 547).attr("y", 500).text("Current").style("font-size", "12px").attr("alignment-baseline", "middle")
      svg.append("text").attr("x", 547).attr("y", 520).text("Append 1").style("font-size", "12px").attr("alignment-baseline", "middle")
      svg.append("text").attr("x", 547).attr("y", 540).text("Append 2").style("font-size", "12px").attr("alignment-baseline", "middle")
      svg.append("text").attr("x", 547).attr("y", 560).text("Append 3").style("font-size", "12px").attr("alignment-baseline", "middle")
      svg.append("text").attr("x", 547).attr("y", 580).text("Append 4").style("font-size", "12px").attr("alignment-baseline", "middle")

    </script>

    <footer>
      <p><a href="https://github.com/hkang1091/Assignment4" target="_blank"> MUSIC FEATURES VISUALIZATION </a> by Vizzard(Desmond Fung, Hangyu Kang, Param Gandhi, Sreeranjani Didugu)
      </p>
    </footer>



</body>

</html>